
{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "Moving Lead",
  "description": "Schema for a moving company lead capture.",
  "type": "object",
  "properties": {
    "lead_id": {
      "type": "string",
      "format": "uuid",
      "description": "Unique identifier for the lead (UUID v4), usually generated server-side."
    },
    "timestamp": {
      "type": "string",
      "format": "date-time",
      "description": "ISO-8601 timestamp of when the lead was received by the server."
    },
    "prospect": {
      "type": "object",
      "properties": {
        "first_name": { "type": "string", "minLength": 1 },
        "last_name": { "type": "string", "minLength": 1 },
        "email": { "type": ["string", "null"], "format": "email" },
        "phone": { "type": ["string", "null"], "pattern": "^\\+[1-9]\\d{1,14}$" }
      },
      "required": ["first_name", "last_name"],
      "oneOf": [
        { "required": ["email"] },
        { "required": ["phone"] }
      ]
    },
    "move": {
      "type": "object",
      "properties": {
        "from_zip": { "type": "string", "pattern": "^\\d{5}$" },
        "to_zip": { "type": "string", "pattern": "^\\d{5}$" },
        "date": { "type": ["string", "null"], "format": "date" },
        "flexible": { "type": "boolean" },
        "home_size": { "type": ["string", "null"], "enum": ["studio", "1BR", "2BR", "3BR", "4BR+", null] },
        "items_count": { "type": ["integer", "null"], "minimum": 1 },
        "stairs_or_elevator": { "type": ["string", "null"], "enum": ["none", "stairs", "elevator", "both", null] },
        "parking_constraints": { "type": ["string", "null"] },
        "budget_range": { "type": ["string", "null"], "enum": ["<500", "$500-$999", "$1k-$1.9k", "$2k-$3.9k", ">$4k", null] },
        "notes": { "type": ["string", "null"] }
      },
      "required": ["from_zip", "to_zip", "flexible"],
      "oneOf": [
        { "required": ["date"] },
        { "properties": { "flexible": { "const": true } } }
      ],
      "anyOf": [
          { "required": ["home_size"] },
          { "required": ["items_count"] }
      ]
    },
    "tracking": {
      "type": "object",
      "properties": {
        "utm_source": { "type": ["string", "null"] },
        "utm_medium": { "type": ["string", "null"] },
        "utm_campaign": { "type": ["string", "null"] },
        "utm_term": { "type": ["string", "null"] },
        "utm_content": { "type": ["string", "null"] },
        "gclid": { "type": ["string", "null"] },
        "fbclid": { "type": ["string", "null"] },
        "referrer_url": { "type": ["string", "null"], "format": "uri-reference" },
        "landing_url": { "type": ["string", "null"], "format": "uri" },
        "user_agent": { "type": ["string", "null"] },
        "ip": { "type": ["string", "null"], "format": "ipv4" },
        "first_page_seen_at": { "type": ["string", "null"], "format": "date-time" },
        "session_id": { "type": ["string", "null"] }
      }
    },
    "consent": {
      "type": "object",
      "properties": {
        "tcpa": { "type": "boolean", "const": true },
        "text": { "type": "string" }
      },
      "required": ["tcpa", "text"]
    }
  },
  "required": ["prospect", "move", "tracking", "consent"]
}
